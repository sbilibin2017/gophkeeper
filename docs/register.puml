@startuml
actor Client
participant "API Server" as Server
participant RSA
participant JWT
database "users" as Users
database "devices" as Devices

Client -> Server: POST /register {username, password}
Server -> Server: Validate username and password
Server -> Users: Check if user exists
Server -> RSA: GenerateRSAKeyPair()
RSA --> Server: KeyPair {PrivateKeyPEM, PublicKeyPEM}
Server -> Users: Create new user
Users --> Server: user_id
Server -> Devices: Create new device
Devices --> Server: device_id
Server -> JWT: GenerateToken({user_id, device_id})
JWT --> Server: token
Server --> Client: {user_id, device_id, token, PrivateKeyPEM}

@enduml
