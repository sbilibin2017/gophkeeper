@startuml
actor Client
participant "API Server" as Server
participant SecretTokenDecoder
participant SecretWriter
participant models

Client -> Server: POST /secret/save {SecretRequest}
Server -> SecretTokenDecoder: GetFromRequest(req)
SecretTokenDecoder --> Server: tokenString

Server -> SecretTokenDecoder: Parse(tokenString)
SecretTokenDecoder --> Server: claims

Server -> Server: Decode SecretRequest JSON
Server -> Server: Base64 decode payload & nonce
Server -> Server: Build SecretDB object
Server -> SecretWriter: Save(ctx, secret)
SecretWriter --> Server: saved

Server --> Client: 200 OK
@enduml