@startuml
actor Client
participant "API Server" as Server
participant SecretTokenDecoder
participant SecretReader
participant models

Client -> Server: GET /secret/list
Server -> SecretTokenDecoder: GetFromRequest(req)
SecretTokenDecoder --> Server: tokenString

Server -> SecretTokenDecoder: Parse(tokenString)
SecretTokenDecoder --> Server: claims

Server -> SecretReader: List(ctx, claims.UserID)
SecretReader --> Server: secrets[]

Server -> Server: Base64 encode payload & nonce for each secret
Server -> Server: Build SecretResponse array
Server --> Client: SecretResponse[]
@enduml