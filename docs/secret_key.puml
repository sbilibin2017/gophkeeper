@startuml
actor Client
participant "HTTP Handler" as Handler
participant SecretKeyTokenDecoder
participant SecretKeyWriter
participant SecretKeyGetter
participant "SecretKeyDB" as DB

== Сохранение секретного ключа ==
' Клиент отправляет секретный ключ
Client -> Handler: POST /save-secret-key {SecretKeyResponse, Authorization: Bearer <token>}

' Извлечение и парсинг токена
Handler -> SecretKeyTokenDecoder: GetFromRequest(r)
Handler -> SecretKeyTokenDecoder: Parse(tokenString)

' Декодирование тела запроса и сохранение ключа
Handler -> Handler: Decode JSON body -> SecretKeyResponse
Handler -> SecretKeyWriter: Save(secretKeyID, secretID, deviceID, encryptedAESKey)

' Ответ клиенту
Handler --> Client: SecretKeyResponse

== Получение секретного ключа ==
' Клиент делает запрос на получение ключа
Client -> Handler: GET /get-secret-key (Authorization: Bearer <token>)

' Извлечение и парсинг токена
Handler -> SecretKeyTokenDecoder: GetFromRequest(r)
Handler -> SecretKeyTokenDecoder: Parse(tokenString)

' Получение ключа из базы
Handler -> SecretKeyGetter: Get(secretID, deviceID)

' Ответ клиенту
Handler --> Client: SecretKeyResponse
@enduml
