syntax = "proto3";

package bankcard;

option go_package = "github.com/sbilibin2017/gophkeeper/pkg/grpc";

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

// SecretSaveRequest wraps a SecretRequest and token.
message SecretSaveRequest {
  string secret_name = 1;
  string secret_type = 2;  
  bytes ciphertext = 4;
  bytes aes_key_enc = 5;  
  string token = 6;
}

// SecretSaveRequest defines the request to fetch a secret by its name, type, and token.
message SecretGetRequest {
  string secret_name = 1;
  string secret_type = 2;
  string token = 3;
}

// SecretListRequest wraps the token to list all secrets for.
message SecretListRequest {
  string token = 1;
}

// SecretResponse represents a hybrid-encrypted secret stored in DB.
message SecretResponse {
  string secret_name = 1;
  string secret_type = 2;
  string secret_owner = 3;
  bytes ciphertext = 4;
  bytes aes_key_enc = 5;   
  google.protobuf.Timestamp updated_at = 6;
}

// SecretWriteService handles saving encrypted secrets.
service SecretWriteService {
  rpc Save(SecretSaveRequest) returns (google.protobuf.Empty);
}

// SecretReadService handles reading encrypted secrets.
service SecretReadService {
  rpc Get(SecretGetRequest) returns (SecretResponse); 
  rpc List(SecretListRequest) returns (stream SecretResponse);
}
